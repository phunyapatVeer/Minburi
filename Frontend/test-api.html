<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>Test API Connection</title>
  <style>
    body { font-family: Tahoma, sans-serif; padding: 2rem; background: #f5f5f5; }
    .container { max-width: 900px; margin: 0 auto; background: white; padding: 2rem; border-radius: 8px; }
    button { background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 5px; }
    pre { background: #f9f9f9; padding: 1rem; border-radius: 4px; overflow-x: auto; border: 1px solid #ddd; }
    .error { color: #e3342f; }
    .success { color: #38c172; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡πÅ‡∏•‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h1>
    
    <h2>1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Debug Endpoint</h2>
    <button onclick="testDebug()">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å /api/debug/test-db</button>
    <pre id="debug-result">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå...</pre>

    <h2>2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö GET /api/users</h2>
    <button onclick="testGetUsers()">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å GET /api/users</button>
    <pre id="users-result">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå...</pre>

    <h2>3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö POST /api/users (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö)</h2>
    <button onclick="testCreateUser()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ test123</button>
    <pre id="create-result">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå...</pre>

    <h2>4. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Role ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚öôÔ∏è</h2>
    <button onclick="setupRoles()" style="background:#f59e0b;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Role (Administrator = Admin)</button>
    <pre id="setup-result">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå role ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Administrator ‡πÄ‡∏õ‡πá‡∏ô Admin</pre>
  </div>

  <script>
    async function testDebug() {
      const el = document.getElementById('debug-result');
      el.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
      try {
        const res = await fetch('/api/debug/test-db');
        const data = await res.json();
        el.className = res.ok ? 'success' : 'error';
        el.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        el.className = 'error';
        el.textContent = 'Error: ' + err.message;
      }
    }

    async function testGetUsers() {
      const el = document.getElementById('users-result');
      el.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
      try {
        const res = await fetch('/api/users');
        const text = await res.text();
        el.className = res.ok ? 'success' : 'error';
        el.textContent = `Status: ${res.status}\n\n${text}`;
      } catch (err) {
        el.className = 'error';
        el.textContent = 'Error: ' + err.message;
      }
    }

    async function testCreateUser() {
      const el = document.getElementById('create-result');
      el.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
      try {
        const res = await fetch('/api/users', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username: 'test123',
            password: 'test123',
            role: 'Normal User'
          })
        });
        const text = await res.text();
        el.className = res.ok ? 'success' : 'error';
        el.textContent = `Status: ${res.status}\n\n${text}`;
      } catch (err) {
        el.className = 'error';
        el.textContent = 'Error: ' + err.message;
      }
    }

    async function setupRoles() {
      const el = document.getElementById('setup-result');
      el.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤...';
      try {
        const res = await fetch('/api/debug/setup-roles', { method: 'POST' });
        const data = await res.json();
        el.className = res.ok ? 'success' : 'error';
        el.textContent = JSON.stringify(data, null, 2);
        if (res.ok) {
          alert('‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Role ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Logout ‡πÅ‡∏•‡πâ‡∏ß Login ‡πÉ‡∏´‡∏°‡πà');
        }
      } catch (err) {
        el.className = 'error';
        el.textContent = 'Error: ' + err.message;
      }
    }
  </script>
</body>
</html>
